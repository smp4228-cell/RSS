<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>RSS Feed Reader</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

  <!-- jQuery UI for accordion -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

  <!-- Lightbox -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>

  <!-- LazyLoad -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazy/1.7.10/jquery.lazy.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f7;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #0078d7;
    }
    #search {
      width: 95%;
      max-width: 400px;
      padding: 10px;
      margin: 10px auto 20px auto;
      display: block;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    #feedContainer {
      width: 90%;
      max-width: 900px;
      margin: 0 auto;
    }
    .date {
      font-size: 0.9em;
      color: gray;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
      display: block;
      margin: 10px 0;
    }
  </style>

</head>
<body>

<h1>RSS Feed Reader (IE11 Compatible)</h1>

<input id="search" type="text" placeholder="Search articlesâ€¦" />

<div id="feedContainer">
  <p>Loading feed...</p>
</div>

<script>
$(document).ready(function () {

  $.ajax({
    url: "myfeed.rss",
    dataType: "xml",
    success: function (data) {

      $("#feedContainer").empty();

      $(data).find("item").each(function () {

        var $item = $(this);
        var title = $item.find("title").first().text();
        var description = $item.find("description").first().text();
        var link = $item.find("link").first().text();
        var pubDate = $item.find("pubDate").first().text();

        // get image from thumbnail or content
        var imageUrl = null;

        // find namespaced tags
        var thumb = $item.find("*").filter(function () {
            return this.nodeName.toLowerCase() === "media:thumbnail";
        });

        if (thumb.length > 0) {
            imageUrl = $(thumb[0]).attr("url");
        }

        // fallback: content with medium="image"
        if (!imageUrl) {
            var content = $item.find("*").filter(function () {
                return this.nodeName.toLowerCase() === "media:content";
            });

            content.each(function () {
                var med = $(this).attr("medium");
                var typ = $(this).attr("type");
                if (med === "image" || typ === "image/jpeg") {
                    imageUrl = $(this).attr("url");
                }
            });
        }

        // accordion structure
        var headerHTML = "<h3>" + title + "</h3>";

        var contentHTML = "<div>";
        if (imageUrl) {
          contentHTML += "<a href='" + imageUrl + "' data-lightbox='feed'><img class='lazy' data-original='" + imageUrl + "'></a>";
        }
        contentHTML += "<p>" + description + "</p>";
        contentHTML += "<p class='date'>" + pubDate + "</p>";
        contentHTML += "<a href='" + link + "' target='_blank'>Read full story</a>";
        contentHTML += "</div>";

        $("#feedContainer").append(headerHTML + contentHTML);
      });

      // initialize accordion
      $("#feedContainer").accordion({
        collapsible: true,
        active: false,
        heightStyle: "content"
      });

      // initialize LazyLoad
      $("img.lazy").lazy();

    },

    error: function (xhr, status, error) {
      $("#feedContainer").html("<p style='color:red;'>Error loading RSS file: " + error + "</p>");
    }
  });

  // search box filter
  $("#search").on("keyup", function () {
    var value = $(this).val().toLowerCase();
    $("#feedContainer h3").each(function () {
      var header = $(this);
      var content = $(this).next("div");
      var combined = header.text().toLowerCase() + content.text().toLowerCase();
      var match = combined.indexOf(value) !== -1;
      header.toggle(match);
      content.toggle(match);
    });
  });

});
</script>

</body>
</html>
